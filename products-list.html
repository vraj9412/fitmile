<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DXVQ77XM12"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DXVQ77XM12");
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FitMile - Product Listings</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
      .product-card {
        border: none;
        transition: transform 0.3s ease;
        overflow: hidden;
        cursor: pointer;
      }
      .product-card:hover {
        transform: translateY(-5px);
      }
      .product-card img {
        height: 250px;
        object-fit: contain;
      }
      .filter-bar {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">FitMile</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="products.html">Products</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#loginModal"
                >Login</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Filters -->
    <div class="container mt-4">
      <div class="filter-bar row align-items-center g-2">
        <div class="col-md-2">
          <select id="audienceFilter" class="form-select">
            <option value="">All Audiences</option>
            <option value="Men">Men</option>
            <option value="Women">Women</option>
            <option value="Kids">Kids</option>
          </select>
        </div>
        <div class="col-md-2">
          <select id="categoryFilter" class="form-select">
            <option value="">All Categories</option>
            <option value="Traditional">Traditional</option>
            <option value="Casual">Casual</option>
          </select>
        </div>
        <div class="col-md-2">
          <select id="locationFilter" class="form-select">
            <option value="" selected>All Location</option>
            <option value="Gandhinagar">Gandhinagar</option>
            <option value="Ahmedabad">Ahmedabad</option>
            <option value="Motera">Motera</option>
            <option value="Chandkheda">Chandkheda</option>
            <option value="Sargasan">Sargasan</option>
            <option value="Kudasan">Kudasan</option>
          </select>
        </div>
        <div class="col-md-2">
          <select id="sortFilter" class="form-select">
            <option value="default">Sort By</option>
            <option value="low-high">Price: Low to High</option>
            <option value="high-low">Price: High to Low</option>
            <option value="az">Name: A-Z</option>
            <option value="za">Name: Z-A</option>
          </select>
        </div>
        <div class="col-md-3 text-end">
          <h5 id="filterTitle" class="mb-0">Products</h5>
          <small class="text-muted" id="productCount"></small>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="row g-4 mt-2" id="productsGrid">
        <!-- Dynamic products will be inserted here -->
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 text-center mt-5">
      <div class="container">
        <p class="mb-0">&copy; 2025 FitMile. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
      async function csvToJson(filePath) {
        const file = await fetch(filePath);
        const csv = await file.text();
        if (!csv) {
          console.error("CSV file is empty or not found");
        }

        const result = Papa.parse(csv, {
          header: true,
          skipEmptyLines: true,
        });

        return result.data;
      }
      // async function getData() {
      //   const file = new FileReader("./myntra_men_shirts_data_numeric.json");
      //   const data = file.text();
      //   if (!data || data.length === 0) { 
      //     console.error("No data found in JSON file");
      //     return [];
      //   }
      //   console.log("Data loaded successfully");
      //   return data;
      // }
      // let allProducts = getData();
      // csvToJson("../myntra_men-shirt.csv").then((products) => {
      //   allProducts = products;
      //   renderProducts();
      // });
      // console.log(allProducts);
      let allProducts;
      fetch("myntra_all_clean.json")
  .then(response => response.json())
  .then(data => {
    allProducts = data;
      // Get URL params and set filter values
    const urlParams = new URLSearchParams(window.location.search);
    const urlAudience = urlParams.get("audience");
    const urlCategory = urlParams.get("category");
    const urlLocation = urlParams.get("location");

    if (urlAudience) audienceSelect.value = urlAudience;
    if (urlCategory) categorySelect.value = urlCategory;
    if (urlLocation) locationSelect.value = urlLocation;
    renderProducts(data);
  })
  .catch(error => console.error("Error loading JSON:", error));

      const audienceSelect = document.getElementById("audienceFilter");
      const categorySelect = document.getElementById("categoryFilter");
      const locationSelect = document.getElementById("locationFilter");
      const sortSelect = document.getElementById("sortFilter");
      const productsGrid = document.getElementById("productsGrid");
      const filterTitle = document.getElementById("filterTitle");

      function renderProducts(allProducts) {

        let filtered = allProducts.filter((p) => {
          return (
            (!audienceSelect.value || p.category.toLowerCase() === audienceSelect.value.toLowerCase()) &&
            (!categorySelect.value || p.type.toLowerCase() === categorySelect.value.toLowerCase()) &&
            (!locationSelect.value || p.area.toLowerCase() === locationSelect.value.toLowerCase())
          );
        });

        // Sorting
        if (sortSelect.value === "low-high") {
          filtered.sort((a, b) => a.price - b.price);
        } else if (sortSelect.value === "high-low") {
          filtered.sort((a, b) => b.price - a.price);
        } else if (sortSelect.value === "az") {
          filtered.sort((a, b) => a.description.localeCompare(b.description));
        } else if (sortSelect.value === "za") {
          filtered.sort((a, b) => b.description.localeCompare(a.description));
        }

        // Update heading
        let title = "Products";
        if (audienceSelect.value) title = audienceSelect.value;
        if (categorySelect.value) title += ` - ${categorySelect.value}`;
        filterTitle.innerText = title;

        document.getElementById("productCount").textContent = `${filtered.length} item${filtered.length !== 1 ? 's' : ''} found`;
        
        // Render
        productsGrid.innerHTML = "";
        if (filtered.length > 0) {
          filtered.forEach((p) => {
            const col = document.createElement("div");
            col.className = "col-md-3";
            col.innerHTML = `
              <div class="card product-card" onclick="viewProduct('${p.name}')">
                <img src="${p.image}" class="card-img-top" alt="${p.description}" />
                <div class="card-body">
                  <h5 class="card-title fw-bold">${p.name}</h5>
                  <p class="card-text text-muted">â‚¹${p.price}</p>
                </div>
              </div>`;
            productsGrid.appendChild(col);
          });
        } else {
          productsGrid.innerHTML =
            '<p class="text-center text-muted">No products found for this selection.</p>';
        }
      }

      function viewProduct(name) {
        console.log("Viewing product:", name);
        window.location.href = `product-details.html?name=${encodeURIComponent(
          name
        )}`;
      }

      audienceSelect.addEventListener("change", () => renderProducts(allProducts));
      categorySelect.addEventListener("change", () => renderProducts(allProducts));
      sortSelect.addEventListener("change", () => renderProducts(allProducts));
      locationSelect.addEventListener("change", () => renderProducts(allProducts));

      // Initial render
      renderProducts(allProducts);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
